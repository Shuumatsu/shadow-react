'use strict';Object.defineProperty(exports,'__esModule',{value:true});var _regenerator=require('/Users/keruihuang/Projects/shadow-react/node_modules/babel-preset-react-app/node_modules/babel-runtime/regenerator');var _regenerator2=_interopRequireDefault(_regenerator);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactDom=require('react-dom');var _fp=require('lodash/fp');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{return Promise.resolve(value).then(function(value){step('next',value)},function(err){step('throw',err)})}}return step('next')})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ShadowReact=function(_Component){_inherits(ShadowReact,_Component);function ShadowReact(){var _ref;var _temp,_this,_ret;_classCallCheck(this,ShadowReact);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ShadowReact.__proto__||Object.getPrototypeOf(ShadowReact)).call.apply(_ref,[this].concat(args))),_this),_this.state={fetching:false},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(ShadowReact,[{key:'attachShadow',value:function attachShadow(){var host=this.refs.host;var root=host.shadowRoot||host.attachShadow({mode:this.props.boundaryMode});var el=_react2.default.createElement(this.props.wrapperTag,null,this.props.htmlString&&_react2.default.createElement('div',{dangerouslySetInnerHTML:{__html:this.props.htmlString}}),this.props.children.props.children);(0,_reactDom.render)(el,root);return root}},{key:'attachIncludes',value:function(){var _ref2=_asyncToGenerator(_regenerator2.default.mark(function _callee2(root){var _this2=this;var includes,fragment,elements;return _regenerator2.default.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:includes=this.props.includes;if(includes.length){_context2.next=3;break}return _context2.abrupt('return');case 3:this.setState({fetching:true});fragment=document.createDocumentFragment();_context2.next=7;return Promise.all(includes.map(function(){var _ref3=_asyncToGenerator(_regenerator2.default.mark(function _callee(url){var ext,infos,resp,text,element;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:ext=url.split('.').pop();infos={ext:ext,tag:ext==='js'?'script':'style'};_context.prev=2;_context.next=5;return fetch(url);case 5:resp=_context.sent;_context.next=8;return resp.text();case 8:text=_context.sent;element=document.createElement(infos.tag);element.innerHTML=text;return _context.abrupt('return',element);case 14:_context.prev=14;_context.t0=_context['catch'](2);console.log(_context.t0);case 17:case'end':return _context.stop();}}},_callee,_this2,[[2,14]])}));return function(_x2){return _ref3.apply(this,arguments)}}()));case 7:elements=_context2.sent;elements.forEach(function(element){if(element)fragment.appendChild(element)});root.appendChild(fragment);this.setState({fetching:false});case 11:case'end':return _context2.stop();}}},_callee2,this)}));function attachIncludes(_x){return _ref2.apply(this,arguments)}return attachIncludes}()},{key:'componentDidMount',value:function componentDidMount(){var root=this.attachShadow();this.attachIncludes(root)}},{key:'render',value:function render(){var directChild=_react.Children.only(this.props.children);if(typeof directChild.type!=='string')throw new Error('ShadowReact: Passed direct child must be a concrete HTML element rather than another React component');var host=(0,_fp.dissocPath)(['props','children'])(directChild);return _react2.default.createElement(host.type,Object.assign({ref:'host'},host.props,{className:((host.props.className?host.props.className:'')+' '+(this.state.fetching?'@ShadowReact_fetching':'@ShadowReact_fetched')).trim()}))}},{key:'update',value:function update(){var _this3=this;return new Promise(function(){var _ref4=_asyncToGenerator(_regenerator2.default.mark(function _callee3(resolve){var root;return _regenerator2.default.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:root=_this3.attachShadow();_context3.next=3;return _this3.attachIncludes(root);case 3:resolve();case 4:case'end':return _context3.stop();}}},_callee3,_this3)}));return function(_x3){return _ref4.apply(this,arguments)}}())}}]);return ShadowReact}(_react.Component);ShadowReact.propTypes={children:_react.PropTypes.node.isRequired,includes:_react.PropTypes.array,wrapperTag:_react.PropTypes.string,boundaryMode:_react.PropTypes.oneOf(['open','closed']),htmlString:_react.PropTypes.string};ShadowReact.defaultProps={includes:[],wrapperTag:'div',boundaryMode:'open'};exports.default=ShadowReact;

//# sourceMappingURL=ShadowReact.js.map